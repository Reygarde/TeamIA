"use strict";

document.addEventListener("DOMContentLoaded", function () {
  console.log("DOM fully loaded and parsed"), fetch("http://localhost:5000/get-user-info", {
    method: "GET",
    credentials: "include"
  }).then(function (e) {
    return console.log("Response received: ", e), e.json();
  }).then(function (e) {
    var o, t, n, s;
    console.log("Data received: ", e), e.success ? (o = document.getElementById("fullName"), t = document.getElementById("email"), n = document.getElementById("userAvatarDropdown"), o && t && n ? (o.textContent = e.user.fullName, t.textContent = e.user.email, s = e.user.avatarUrl || "./../assets/images/avatar/1.png", n.src = s, sessionStorage.setItem("currentUserEmail", e.user.email)) : (o || console.error("fullName element not found."), t || console.error("email element not found."), n || console.error("userAvatarDropdown element not found."))) : console.error("Failed to fetch user information.");
  })["catch"](function (e) {
    console.error("Error fetching user information:", e);
  }), fetch("http://localhost:5000/api/conversations", {
    method: "GET",
    credentials: "include"
  }).then(function (e) {
    return console.log("Conversations response: ", e), e.json();
  }).then(function (e) {
    if (console.log("Conversations data: ", e), Array.isArray(e)) {
      var s = document.getElementById("personalTab");
      s ? (s.innerHTML = "", e.forEach(function (e) {
        var o, t, n;
        e && e.members && e.messages ? (o = e.messages[e.messages.length - 1], (t = e.members.find(function (e) {
          return e !== sessionStorage.getItem("currentUserEmail");
        })) ? ((n = document.createElement("a")).href = "./chat-personal.html", n.className = "list-group-item list-group-item-action border-bottom-0 d-flex align-items-center gap-3 px-3 rounded-2", n.innerHTML = "\n                            <div class=\"d-flex align-items-center gap-3\">\n                                <div class=\"avatar avatar-lg flex-shrink-0\">\n                                    <img src=\"./../assets/images/avatar/1.png\" class=\"img-fluid\" alt=\"image\">\n                                    <span class=\"avatar-indicator active\"></span>\n                                </div>\n                                <div class=\"flex-grow-1\">\n                                    <h6 class=\"fw-bold mb-1\">".concat(t, "</h6>\n                                    <span class=\"fw-normal text-muted text-truncate-1\">").concat(o ? o.text : "No messages yet", "</span>\n                                </div>\n                            </div>\n                            <div class=\"fs-12 fw-normal text-nowrap text-muted ms-auto\">").concat(o ? new Date(o.timestamp).toLocaleTimeString() : "", "</div>\n                        "), s.appendChild(n)) : console.error("Member email not found for conversation:", e)) : console.error("Invalid conversation data:", e);
      })) : console.error("personalTab element not found.");
    } else console.error("Invalid response format for conversations.");
  })["catch"](function (e) {
    console.error("Error fetching conversations:", e);
  });
});