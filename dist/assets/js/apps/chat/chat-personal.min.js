"use strict";

document.addEventListener("DOMContentLoaded", function () {
  var t = new URLSearchParams(window.location.search).get("conversationId");
  function n() {
    fetch("http://localhost:5000/api/conversations/".concat(t, "/messages"), {
      method: "GET",
      credentials: "include"
    }).then(function (e) {
      return e.json();
    }).then(function (e) {
      if (e.success) {
        var _t = document.getElementById("chatMessages");
        _t.innerHTML = "", e.messages.forEach(function (e) {
          var s = document.createElement("div");
          s.className = "message", s.innerHTML = "\n                        <strong>".concat(e.sender.fullName, "</strong>: ").concat(e.content, "\n                        <span class=\"text-muted small\">").concat(new Date(e.timestamp).toLocaleTimeString(), "</span>\n                    "), _t.appendChild(s);
        });
      } else console.error("Failed to fetch messages.");
    })["catch"](function (e) {
      console.error("Error fetching messages:", e);
    });
  }
  document.getElementById("sendMessageForm").addEventListener("submit", function (e) {
    e.preventDefault();
    var s = document.getElementById("messageInput");
    e = s.value;
    fetch("http://localhost:5000/api/conversations/".concat(t, "/messages"), {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      credentials: "include",
      body: JSON.stringify({
        content: e
      })
    }).then(function (e) {
      return e.json();
    }).then(function (e) {
      e.success ? (s.value = "", n()) : console.error("Failed to send message.");
    })["catch"](function (e) {
      console.error("Error sending message:", e);
    });
  }), n();
});